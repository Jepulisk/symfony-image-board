{% extends "base.html.twig" %}

{% block title %}/{{board.abbreviation}}/ - {{board.name}}{% endblock %}

{% block body %}

<div class="content">
    <div class="pure-g">
        <div class="pure-u-1 text-center">
            <h1>/{{board.abbreviation}}/ - {{board.name}}</h1>
        </div>
    </div>
    <div class="pure-g">
        <div class="pure-u-1 text-center">
            <h2><a href="javascript:;" onClick="newThread()">Start a New Thread</a></h2>
        </div>
    </div>
    <div class="display-none!" id="new_thread">
        <div class="pure-g">
            <div class="pure-u-1 text-center">
                {{form(new_thread)}}
            </div>
        </div>
    </div>
    <div id="threads">
        <div class="pure-g">
            {% for thread in threads|slice(0, 100)|sort((a, b) => b.replies.last.tsCreated <=> a.replies.last.tsCreated) %}
                <div class="pure-u-1-2 pure-u-sm-1-4 pure-u-md-1-6 pure-u-lg-1-8 pure-u-xl-1-8">
                    <a href="{{path("thread", {abbreviation: board.abbreviation, thread_id: thread.id})}}">
                        <div class="thread" id="{{thread.id}}">
                            <div class="pure-g">
                                <div class="pure-u-1 text-center">
                                    {% if thread.replies.first.attachment %}
                                        <p><img class="thumbnail" src="{{asset('attachments/' ~ thread.replies.first.attachment)}}" alt="{{thread.replies.first.attachment}}"></img></p>
                                    {% endif %}
                                    <p>Replies: {{thread.replies|length - 1}}</p>
                                    <p>{{thread.replies.first.content|slice(0, 100)}}</p>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
            {% endfor %}
        </div>
    </div>
</div>

{% endblock %}

{% block js %}

<script>

    function newThread()
    {
        $("#new_thread").show();
    }

    setInterval(refreshThreads, 30000);

    function refreshThreads()
    {
        $.ajax({
            url: "{{path('board', {abbreviation: board.abbreviation})}}",
            success: function(data)
            {
                data = $(data).find("#threads");
                $("#threads").html(data.html());
            }
        });
    }

</script>

{% endblock %}
